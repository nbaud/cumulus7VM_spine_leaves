frr version 8.4.3
frr defaults datacenter
log syslog informational
hostname {{ ansible_hostname }}
service integrated-vtysh-config
!
router ospf
 ospf router-id {{ ospf_router_id }}
 {% for network in ospf_networks %}
 network {{ network.subnet }} area 0
 {% endfor %}
!
interface lo
 ip pim
!
interface lo1
 description ANYCAST-RP
 ip address {{ lo1_address }}
 ip pim
!
{% for interface in interfaces %}
interface {{ interface.name }}
 ip pim
!
{% endfor %}
ip pim rp {{ pim_rp_address }} {{ pim_rp_network }}
ip msdp peer {{ msdp_peer }} connect-source lo1
ip msdp default-peer {{ msdp_peer }}
!
! Add BGP Configuration
router bgp {{ asn }}
 bgp log-neighbor-changes
 address-family ipv4 unicast
 exit-address-family
 address-family l2vpn evpn
 exit-address-family
 neighbor TO_LEAFS peer-group
 neighbor TO_LEAFS remote-as {{ asn }}
 neighbor TO_LEAFS update-source lo
 neighbor TO_LEAFS capability extended-nexthop
 address-family l2vpn evpn
  neighbor TO_LEAFS activate
  neighbor TO_LEAFS send-community both
  neighbor TO_LEAFS route-reflector-client
  advertise-all-vni
  advertise ipv4 unicast
 exit-address-family
 {% for leaf in groups['leaves'] %}
 neighbor {{ hostvars[leaf].ospf_router_id }} peer-group TO_LEAFS
 {% endfor %}
 !